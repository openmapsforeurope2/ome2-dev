![under_construction](../../images/under_construction.png)

# administrative_unit_area matching steps sequencing

## highest level matching

| country                        | country_code | distance | highest_level | 
|--------------------------------|--------------|----------|---------------|
| The Netherlands                | nl           | 1000     | 3             |
| Belgium                        | be           | 1000     | 5             |
| France                         | fr           | 1000     | 6             |
| Suisse                         | ch           | 1000     |               |
| Luxembourg                     | lu           | 1000     |               |


### 1) Extract objects around a country's boundaries for matching:
```
python3 script/border_extract.py -c conf.json -T au -t administrative_unit_area_<level> -d <distance> <country_code> '#'
```

<u>Belgium:</u>
Example of an extraction around boundaries with several neighbouring countries:
```
python3 script/border_extraction.py -c conf.json -T au -t administrative_unit_area_<highest_level> -b nl -d <distance> <country_code>
python3 script/border_extraction.py -c conf.json -T au -t administrative_unit_area_<highest_level> -b de -d <distance> -n <country_code>
python3 script/border_extraction.py -c conf.json -T au -t administrative_unit_area_<highest_level> -b lu -d <distance> -n <country_code>
```

Example of an extraction around all boundaries:
```
python3 script/border_extraction.py -c conf.json -T au -t administrative_unit_area_5 -d 1000 be '#'
```

### 2) Matching

```
bin/au_matching --c data/config/epg_parameters.ini --t <working_schema>.administrative_unit_area_<highest_level>_w --cc <country_code>
```

### 3) Integrate modifications in the main table and working history (wh) table
Before running the integrate, check in the log file whether invalid polygons have been generated by the matching process. If there are some, correct them in QGIS.

```
python3 script/integrate.py -c conf.json -T au -t administrative_unit_area_<highest_level> -s 30
```

## lower levels merging

For each administrative level, in descending order from n=<highest_level>-1 to 1, proceed with the steps below:

### 1) Extract objects around a country's boundaries
```
python3 script/border_extract.py -c conf.json -T au -t administrative_unit_area_<n> -d <distance> <country_code> '#'
```

### 2) Merging
```
bin/au_merging --c data/config/epg_parameters.ini --s <administrative_schema>.administrative_unit_area_<n+1> --t <working_schema>.administrative_unit_area_<n>_w --cc <country_code>
```

### 3)  Integrate modifications in the main table and working history (wh) table
Before running the integrate, check in the log file whether invalid polygons have been generated by the matching process. If there are some, correct them in QGIS.
```
python3 script/integrate.py -c conf.json -T au -t administrative_unit_area_<n> -s 30
```


